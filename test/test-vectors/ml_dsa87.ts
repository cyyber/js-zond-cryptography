import { ml_dsa87 } from "../../src/ml_dsa87";
import { utf8ToBytes } from '@noble/post-quantum/utils';
import { bytesToHex, hexToBytes } from "../../src/utils";
import { deepStrictEqual } from "./assert";

const TEST_VECTORS = [
  // Test vector taken from https://github.com/theQRL/go-qrllib/blob/main/wallet/ml_dsa_87/wallet_test.go#L25
  {
    ctx: "ZOND",
    msg: "ML-DSA-87 test message for signing",
    // sha256 digest of f29f58aff0b00de2844f7e20bd9eeaacc379150043beeb328335817512b29fbb7184da84a092f842b2a06d72a24a5d28
    seed: "f1e4118b9beb0e69d9dee85610b7bde4606a3f8415afad4883e84ad59fe20607",
    derivedPK: "d2d7a04f06b477907a62a7c5ba0b8d5bc0755354d7dcfed5c4268f324aad7afa3763f3538a0bb6fb4e03106bcf9282b8f06a14d10d2fb325b2dc4aaa729bb9f96b6f93fd26390bcd4fae8ab22f76c9e7f8d2eedd5f4d07061cfde53ee02a9125e0f49336357ee96c0b1494befd49e4771977cdce1a22b445213d8a0af9c6c69c110f6e37ed4589387fbf693f7ccabe46512c2fd5845399790c545da71cc36fbf37f84f810e76d9f6d2e545ecbaea2e182616ec6394229b3c5d2b476f4c31c45c19e76bfce9b101bc9360e400920b75280915e2d2fd3ecabb458c66bd414efb3cbaa82ec03e9f4bfd723d16da088dd0bcd6b62e1cead240eb630b594d1793be1a0dce8e6832e3bdf7767a94f32a096a245a46e8580d137ecc4c12dbd2f3ed7b0fed2ffd9d28e391b959a869401d30e84250ac4d1ca476488430a5a44770fa043c9118701553e8c84bf2c70c0b9ca3e7a4836a4881e754b2a59fc0a35af7f8bd6b8d4abb4d5582e8ec8be9f7ae3a11e32718d07dfc2b518e1075cf36087c6167dc344f91e240f8c02335c8df200c2bad5010f50a1501a32786035c2877ddfd4f74f01fe93d07ed2c4405ac198ca50c2fb2f61e0552a48aa4c177d2ee76b02629764146d98b58af4751d140fc40ca94240f85b43e7bb45a1d9f9728398437c56b9023c2d248011dc6ecb8b9201496212593204722ed2d8054e9f1de6e13c9509b4984a928b003088430001abd0257cde9352fd80cbad728b8645ca7e3d722d5a2ba211a5bebf7adba676a06d4edc7284e522b19412d31a1de6c2e09e0147759cb3554a68bec189783a9ff6fff194a5325db68e1d4903415d4ffb19f18ddfbfa51568b77d55461b4443ea10202d7bc4121dd391915c09654110239b73a4b209f31d86fe50fad3602b8fe9cc6e6fbdb441ce43a6d56ccc11e39e1353c987e5af5f34b0439d3146fca9c8067e4b6ba53abb23ae634f25ded6509fb76293a5fdb1d32671cb87df5981ff2970f816e2011eaaa6ec810a9bcc670d959b62d79df9ae3e8643237d41600df6a3be8c0c8e3ef95e1ce0cdacf0fb2e24e44e3b279ac7e97c433143714c269923acc644634da6abfef9f3a19bbce029f5e49a63e645fbcf08771829e6996faa4f551142a3a2b6bd647b498105b537a9e829351824b873f0acc568e26e554c987ed21ee302e00a3b6177d1779101b0f2945782cc95df387d14425de4180b401d9fe3516697162b119f0d181c03d1449199ec40f03545ce67997715a749085bac6fffa005ba6187130e831af6e41cf2ff2be59cbdf0b3076e6aaa41eb8da4a08920f68b024f41816e35e7e492ecc0b964fbc11a6761e463da7a5943447b44ea8d1d491cd2fa1ab5d0d9f2a3f3719ed3781a961a85dfc94a4539926af967003cc1ae18b4401e448a4da38f91adec2aca6abf445921008d7bdf3e0da818afc64f13078852eeecf8f291abfd5a992d2a82284dc36ca9f3201de67087ddead3f239fb2c0afa240fc451db64d159c0dee372a5f4f2374e22edce0137521400e4831f8164d90991f3eacd106154f24061c6c1a757ff47aeb21421a93626680c61d808c359c14e4c4be92b0fe0a24590c5a406e9e2b6730c458510129df62aa281339b1d117fe38d62f530042b16eda0a3389ea8bb1d617bf0e3e75d03d2cced188184ad89ffb044a91e7bf18b9fc95a48cdb2c9863224df03a9cdd269c2bfae5f312de03f0bde5d6f47c270a679a49af372d96ec84999195ec584cb8a19793f764f314f117d470091b7ff1ac8bc0a1d53b575e6bee6cf76b8eb56a9ac73b8f925657986418a21db2cdb0f5f3b604884ac53ed278f49976859ebf3ab51b4a7d1084a145757f0853579b7bd9b4c0233308edae2848f6c3b3fa8268fcf8e4649c587a89fbc492f2ab9fe2aa8ba62db6e1ad64315d9d974169926f7a45bdb518c4f58f24b4c6b9a45bf78725a1ff218648300383320f53af620c548b91b3f05ee705b3892bd7788c28151483fb20d2bc042f4691a9476524ead501114931b561792f34003be31d75a246ebd1b32214c9b307cc5c01b20f4f53a8b3c1d41b5c62b0754e7efc11e4f0f0d602c09ed00b4aa4c2f5bd07b9adfbd67748f6a1c144f088513b7f963d8be5c9ce5faa0a8bbbdd6406885119d2606de058af4bb721f6d3894487effd64b2b1eaf7edb37572a5b0715e5e1ba0967c1b591d5647a9ce581748ae1c7e86ecb9787918d232a37b4d6f03bd4462d96b839c171581f1c3e7ad689775290bae38e3f18c1c260fb61b23790af68fcebcc94dcdd3191521b1c87b3b7f2f503d8024b9bb8498a470b1dc9ca56eb1708803a408b6d850a3090eee75aba9b407caeb63250ab6e796778b04466f055fa1272df81e21dfff99a780b8737aada488de893fd6f5943ddd5481f6538ca8c1d7853384919cd719d67dd68adbbe5b539c111e7efe95e01cc83fef2a1458d81aeb0c3cd5e4fa3338f10ebe34dded123f612e99cbe4bd2798702c11e65a5e5d615c3e6b6ffec22ae3b8594ee1aa674d44db73a035e7a2214e71e0173f4381794e00fdc14550300ce1fb1fd0a2af6fd57e593d03bfeadf63c4fff0b3f14e9af9d716d4ccb012d248686881f324df220a671957945ba5d8e4411513fb98913608b86a3d17e39125d9fc6e4004d03a03157ca6e4ab885d39edfceba4cd0be32cd94f7a45903d1291ebcabd20a6bd9291228e8b9ca473db08ffe50cd8066323767239d1c780756f12e68d3db383fd9e02407b9c4cfd3d15c1809eab0d3f67cb00d4e994634164c6c0a26337ae6e39c2067b48662d3b35c49e359c0b4bdeba2d167d4e649634e2d2e6413bd3fdf68abba0cae31abaea0596b664d573497ef038843deed7580aff064b900a67646a0eb090dba30ff748445780e88188679e4f1249d8a56f795e31b7ad08cebc9277492a5d774c596ede41dfe67dd7c4a56c1f3651927259d830a4a46aa9b6accbcb58713466f0f14e28867f97df163ea8420a55077b521e9953c2f52049d21530a54b70b992b4b07003829f92ea1a0a91ac3cc186309ba3011aba87272eeebd4e578992a57a9644240752556067fdfb95ead63e29faa2d581851938c76b38fb19f7337e642bedec496eb2fbda65891f9181986bc8317f5f6e2829839fe05c2b44c675a94ccd3296628bc4bb728dd788b6f939da7af1a5e161650931a8e16bbf5035f0769f018c4075d1f107512d9bca93f98c716b93080cc61194dbb9e245132c711fef64442b6d75c3329a9c46b249b1dcecfc8e93bdfa7ce439f66afadbd5fc7b54c86e4783d2c6c397a6b3c482ccffceaffe22ed6c47c27d972a4529cf58c5b18ba50aaee96be9f5c0412ee9bd7e0a5bc0848a519762591cbaa1aaeeaaa06e07424bc7d21f8a12046a7d13cb08ca106984c456a82d9c2d91e188e30d8b6cf62546ff6e46eaed60d1b4af9ae45780524f5bc74e44708f2b995169559153d0d8127841923240543682fe8274b95519615ce375e51bf06dff7f3a6343b6f40c69d6f2b989c8848419c4cff4aa09734c7070ce50d3fc9248208cacb0be1325c226fbb906a32d742eb81be7e92da9b9ac9fe572ea4713524899d70c3ef4d60fa87aa9783e58b043a35e96e436b547a55e91699a21cd76e1afe459bf2c9ac60bf58dd25c11c3",
    derivedSK: "d2d7a04f06b477907a62a7c5ba0b8d5bc0755354d7dcfed5c4268f324aad7afa3a7cc2c1f05b40ff4296034bfb4360bf3d21b700c690bff605a238fe264fbb356623552a7592f6b25267d40df412c6a1916014918bed88717963fc5e8d83432dee6db2155d4e4bd18f2e9f7bb72be6349571319edfae246890b62c69aee97dcc23316c42b608099169dc20708b404802b3718486709ca80599a86c4b160c430452d3c2240c222420306e4c3866118924ccc61154b0494c288613200e10380dc400418b468199446660a68d92186022978c51406552082a9444449386718414902107899a248a1b378561082d422266d13240099465234028e2a0108b128020134a54006c8a080c13146a1a13041424114b2000213760d98290a3a66c03056663367063463153344e23252122298cc8a4605140691bb98091c8280b8404a3b844a20260c4448d5c3486d3c210e106114c9010889441d34828d9840824822d1c1772c41621d0884d122346411801db24060384800a860510a5484018654236205004711218904b02059880458412899a46485cc885a0b0110984710899258a984183383212b928d8408e90b661c2963060284508a78dc0164a899481db96811b334218b52c584605531885412009030430cb002c2024326440446294409c34485b36304140846442321cc9441ab445614422224672c0868550284823214d9302294b028ae0a4301b112c8aa44011866c21c3610a072410264401474a02312614c2880b292848b4681b196d82824d409229e1204651284698206a19b30c09a13082822910b67118b664d2940840a84cc8a028c1a008e4203114c8458b366e58c089c810321ca70090a8210382304c408d5ca24123962d5280204c426622331101318113a18813a74952384c13b53189224d9198512118690b258c81080eca462493a06d0c1611e4a86064203044b24564044a89a02122c52122b149e1a44ccb9860901472e4a02d4ac6618c128e238330602484caa22510c624cb88914010290c079024481113b26918b848534669e1b26d8c424ac9980c6214710c1240d1842d1c311250944864c40980c60c513445c3409210c40950126e82148a91046221c705ca120a94108862168453b0501b894508a34994203011118d4244641ca630201130041466813470dc468222a700e43422c3464118b6310ab96808073094a0281a1241e0122413976044066c619665d8a66400042e183428d3988154161010444dc2180e9b0209131285e384916090701c228518b380c1320403428044c26108c58013174a8a2052c192444a82509c22084910642308050c402111364ca33624e3c86c04076d20c448939000521070829865dc320d22878951a02c64969001a62c9c906043906c4280600b4302d0906c9b34720c18054a142d13418808b2612422249a987109b3818c1462603222e40486814065c1c650891601d4c80d1a3430032389139989593600e3c42941b8718ba2091393691b376018b141dc98081c12624bb448c9880d1b908c8b100444064a9c0842043492102689a13281919421e2a40da4c6502323281b861141b289d9008c80c431e2004d400042d1362c920861011231080809449464c8b0600b9090c8880908c7910bb71114890104072e9bb869c22686d38884401408a34869cb125292a045c8302d50b811a1146d21c84d02218d44060c0a248c0b262004294912288a5bb0891c134113480d5bb02d9ba429a2346d9a046019026e54464a9a2608923608d04452c18684193312db24490b4502e21026a2a4616092200211480921300c9068d0088623c48542420a80b401239171cab0259416840b47601934494a42202117264a44015cb4614b4421982646510484a314298a966d899840229581a330650943001ab520a3164460a210c2241208416acbc630129700400689c9840820c1691221844b966541846c21368d53b480434092ca42644aa8498b204de22452599021d308440131290bc9108c44928938328a167020a9488c066208a4251ca10c1b095223168d00260dcb40100bb584a0b428e1a00c1482410402921a252cc1088a14a94c402092138165d1a04c5c180c60222e49320800144e59964d21016151824d12130cdb467223034dd3368c948031120869200911c21648db404a03a24c4bb465104385d2342584a0855494053aa0cf0c4a981cfefb3e1a206b7b95f66395c65be670c10ebae3838cf549aea34242b7065b0e75a82a45560a8245c66e6a735d36805f8c924ca9d156ace5eef31b277bd940fb4701defb0af731a2ef455433c6a85fad10909a55ea61a58483c0a1ca46117f1720420dfef998fc894cd8a229901d426eb7274ad4d5b04fb382f900fd9aaaba7302b883bacc9ed092526f133a632c35967cb3edcc8fe27cc75abd05dacb212c175fac2d93faa0c11d5390b89f89c50ed50991b438935339b3c204d7f8f6ed7e3215f1124d3c821bf77f1e924a87cb116a461584a24e9bcc3a87a7ff70989841874ad7851596eb95b1716d93ebcf2bbbfe1d41f36b4c1f6499183364c340d35acbf5c731b2b1e1ae43c9936f376821be2721d3413d258ba076030a68c44734f56e262ce4171ae8480e0361f0314763f1614aa512810102c1b759d193b0986ad282b6b26a84e69bf822c90c2a82337fea20746cd0359ad28874599d191c1864649eb0d45f1b7526138794bf0519930d8e48edcbc2510fa14115ea4f8d55e91dd9bff53271067120629635ef7e23a291621ab030190c4a405cdf4825e09b451144ed41e7e072a608015c3e6d2256331a65bf4a387d2340cef55887ca4247f5523d50a4d3afd49072ea89a322ce0f7b27c11f091716cfbd2f58e16d2426e19216f8ea73b5aeb074ba0da97c33a232a23151742e6706279b8d4cb10cef0631c30fde83f0a816dbd28de5c4e30dca11546ed43718805ed3bca8d9f2629297988e6d2d70fbf4e7e4e3aeb9aa220b238abcd738d3871f2a48ed6a62405c1436ab97575be4d5ba6afee621c2c2cf4f75daa94daa134b816539f48d1357b2b40fa8bacccee8ea7516017a0fb931f2610d5d91d669d90814e80db314d8b84b250efc7ed82ccfeba082435c361fcc5eb9b7687cd0f0bb20af8db9faea63fbddb84b5d7e7bc9af5424b2c209d87cfd4124d170d72b9d3f0252c6fb95d64a34da6b0251a12f1849b254b6bd0b7f5c7eb7cf41d9d98ac60fe8b5600655e91b4cc90737e6a47584194a1f06eac9599a8caa261fd38b55bb3cd77e4d6e495bdf776e9d9021a52e756727de756c5bf584994fad7b1628444c275d0606363a9c537c55759b1c1e74297aef9bf484075818dd627942ad1e654da45dc4a6a8c969aae00e57da69b012744f8eec4e08c05ee68bfb5917b2b1231190188c69519ccadbfd456a2c9488f30743c082542ba0f59e633c401515bd17b369099b3c2cfe605d4f7ae8e0568535f97f587d862a20a118b9fed6fe30b32328a2f6a52fbfc4bcc2b9350d3da32be72052cdfb3059d902cba702ca82c623f0b89978968c419d32ac1f57d45b83cf0496e2166d62a7e7711d68a755ea2b601829cc5023cd6e9edea2a3bac1260e99adb696c9a8d7ff37ef0724cc04d21a53c6a8c6c8fcdc4864ec46993c0f92987a6a95e85a8f743ec8502c34488dac11a0e0bd42c0e50d56e392c49603298ecec6b7e0a42c6816f1511345b9457d4300c1adf6df287866fd11f4ee1a2e16c0f6c43382980aefc8eac88b76cca070f23a29e290351f01d4f17362209dd3a3e89be8e75c0879863760cb912fd4ed47aa89861e907740b5cbd2bd813048f5918dbc104bd170c440f342c8bbb51b45bf904793a26f5827f4b14c1837be87da8d25b51173fd6b06b4af8452e8dff073e58c7f14221e7900cbc11635cd18b046ffe2017956d36161a6d3ce458ef4b8210d6b7149eae7f4a57a3aaed988624200ec29411a95b50c84609f8876ca4f4ba8f919d9b5f0ba7f96b8d04036d23c20a9231324def4bba24958c0cfea232ef609e14f89b31760354f79fcb571bc32b14965456b9aa1563169513fb2c2f9459016b11e8b806ae81c5c2177f5a4b55ba518ff80a97e4e29465a3596eed68fffd016239fa1ce7d860343818ba123dd082d6099bb7b7c35bc34ae0fa9aadd53770ec270951e45d5cb52f4c17bd5c097debaafb376c531add50a985b21cb1387a0d2b053459751dd6ee74bfae9ff8d1dd9eb998643a7093224585daaf9f80aedda6648dc3f11a1bc4de4a29a92972cd2f117f591a1e853a161b1d09a083af6f4a6272d9ea018fa4cc18b53596f713c1a8ccae68f5ee166541f5743a5e24732edaa59ade18c1a645046773e570552955c892e26ad03c13223f02eff90753dbe28b19f96cbcee7bd4f4f977731f6e13b230bf639154dbeb32044be1cd1cb2c57c78eb44b82c5eedcd4adb57410a85d078b83451c4900f8c7d0a8487f322068854f1c4bac67b6ee85ffed841c34372f90075e9675d0255ffcb31e6cadb1431af318143c0739e67d5fbdbe48f733e3ff172c3a66de9906fc62245407a209b8429b8c53780c700110e8d89a31426d243fae5ba847119d1d3819cc9f68743374302346669a3b4bf489e77b1e061096bcde9b63b1f7acd23a37221bbfc064a6af67c44395b3c52ed57123ff09f59720dbe77af462b16ef57cb9433889cc5975c0931774300476a2672301d470a489673217635a5382a8272f741baf15ff2f09198a194d9b586bcc524b6c82f822ef67181041084176386773ceb8ef6417277dd8abd5cda95e00878c2bbd5bc801bedaafc41740b06e7e2876873f7e4dd84de7c563e05d340d42869614cb612c1a495546ea5006a2dce17f3d703c62fb24c62a5521ad31dd552c45b8da21a97293283322ec4ad7f6975eb2fa271717926d344fda7dea5fe71401f2023bddaf802fef794bcbfc05c53546fed16168b2609027b7cd55faa487a6fba4b22eb72fdce5195b783924b87e5c7b958186305146f79aec1c2e82ec57bb6c561417a91cd80b05bb2be67717b885a8f881de9394c5610f858c6e0533c182dd4a9bc371c580e4a87c53eda8f2df173f4037c662296be6876c3b290b92dda5291d6468e9f193fe5f05f5e913f02ce4ad86457655cf61f531f17c66e0b63992260d0167fb7a399f03bef03f5d4af9c69500c438e45a4e7bccbce6cd08ffa5f67c7fe3bc93e2c5338147fd0fb445a5c77ff87574f645c07b9eced57f0a71acd8066daa248e27cd768476a86091689584fa10ae747972d4a005cddf22f404001f4f008fc4b511e00f6a14d942d516cd3e1924ad0c9ae321faca2e94b3dc3dc9e6af22a18dc9a545db3681c6668ba20ce8114a75658c438f0702a33dcb5509b7dd987cf0104a1927e1ccacba29159566ee059f3704d81a28771b7f5c51af330b50a04b0f901e10c6640a27ea9eeb53c895fa381ebaff0b5e9032d7a53889600303148d1f69d62d1d54a8903b6e93d339d71bc03a80a1d206e4217bfc4b50cd6ed15d60f2a2ec39bbc8b9bf55814d1f78491fa42a42e54fab4dda91267c77b05ca8593d7d605a93c057abc292ef6141651dbc33c064c21799b7aa8c383389b95c3f4ff6d7ea6e7db11236cc3a3b88bed1e3514abc2ac7ad1a862a3cfc7340608cd041b944bcc48ad1440ec26ade7910954fdcdfb23bae82ffb675862c00bb2abf689f644a547097752ad82f9125f3d52520cfa3ad7e4531320859e6865238b67c87d3e913ea4f52bbbc48af499899476ae2b0c317c89357794ecbf22271c05de454ecbc8188cdebf6a5119cf5e4726599ab5c0fe835cc9c140947840b4a9ef1e3b17de35c36cb0b5024fc5731d225b091adef43f942efccbfb437056faa66b4ceb0718c11b201cf3f27bdec7be8c92988b39ebb4266ae25c3cfffb14c34843a2971fb6c9250a7fc5c8692cb2d3faca049353f514b1e0f1ed1cfe8f16f3fef01e744d6aaa77c35ac56f3df460c745ecf1befb3244d85608910dcebb0bf504098e1b0c9dcf7bfff521b738c9585c0cb7e0cf4597abec48c54b73ac7cb5205e28a9f6691cc25281036b80078b8841242c7ab5180ab47eb202dae22e678a63a798c759286961f9721a8654fb2b00c7bc474659b9298d380f40907378e6b9788d02845a1bf7c45d73813d05e143f020ced61eed0df51476d62a5b44ba6d26cd8de581babac9c1b24f6da35791fd5ca644a6cd6c0269217b8ce7a897cf22968eedc8e9f8d36ada03b8e66c77d000566ba1b009786cab06beebde3026d9726c9ef58135809a8163aa9f65675b53571d20636a29988a781b9489ec7bc582251cd2a63ad96e059e12e03d3f47989fac26f5a9b562849f433249aed4065daf22329441e5462c64f38a2ea7b129560de3007a7d22571d5ab3d2d7e7ac05909c7592b40aec33d73133274922ddd8dbf152d8a1d909088b3203ce53e7bef3f76f7cf087c95a82421262eaa5acb4b647f2dd393026dbec206d234c9ad217eac4fc1c72d969dcd3a92fcf25f26bad240b14b461159458e3a150a1a772c86ddafd3564c078a34e09d09ac1662f80bb123a73d09cf341ee076ab0a30c74ffadb94d9e6bb5c9681b50d188041fc162d79bac2c103efe3931b4d0d2e6c23b5fa47ec828da9b5cd9a8f090ef192b7b574715ddc7fd892bf64bcb31f417e3ac78c793392912974650ac56602fc443b59b778d370cb3d5d5a0b1ea4fbe80382cde8741352201e2b5381f0c5fa1c3d4e975cdc8b548e749b4df2faafc8be56d3e4b8c575cd6e130b48cf3557a28389094164363a03368b55390d046cc58a379948b0d412137264e5ecff4eefe0e544a76eb3d1a1a0b9af67e4eb8b3c801ac5b7fa7f285dd910e7417503d9e47d54e99896664ec3a3535ef6373758c802d929",
    derivedSig: "b420418a391f820a2417d2d94fdb4945975e2ded6c179af1ef4db5c9e7267fdde366a457d0e819d05eef6c984834104dd85f01c7aa136ec15ba5f39ce3dceea920879050c3b553e7e7331ef58c9c254f05491c3ef95bd3cc2f93770a72380d29d5d9cbfee08d55485a0105c6150b13fb085188067566f893242f492cf927f84edb6604712b216f058aa1bad64977ea3e2af3434d85d81a8260b0e4e73109920b9f1dbaedc5e38e5c0bcf8e7a322ad7c0d677ceecccdac69b64eec75d5d6b4d23eaf91e7ae2ef166a5770fe4c9b01c11d011d10228711d54ec024d704a2848df6a68b1eaef4215ab150ab46667d29051374372913bddde231db6d1295c3cbb765843ab3b5f0a2a6f7ec49ee6095b6d4c8bdfaeb44effe386b15b8a06e75914a85b6dd142dfa8d2839e6af5e412bdfe5c89a75b838caa7fa91ebcb83a8a7b00e3acd188606c06884263f8d9142f0cfb55d94aedd820676470288e5e262d0bbda0b088177e8ac7c53ea9d0f084a1a863c60a7194b59f85667ec269d798c3b14a2c292e646a11a911214bb8504814aae1d0ceb7aa08d0769fa4de1a05928c00d4d4a24182a79ef2dbaa3969e30c03f9d1cdbac3d5b2f9617ece900b2054e36894a6e1ad2da87e699e82ce2ce43e94a396d2f3088088cd3c7f7689f29b5ce8ae4aa6ea769f32bb3969ea76e117d1983991399fb119ef4900a1124f70d34f2a008998e209d1699fd0d3537d0f51d02e390ab86b873aee68eb534d2c97cca7a301bfe80c01c0e422e6ab1bb5858ffbf05bc039000986ac09562d78ca53f8b3195c9a0a5ad32e74ce463982078baf0ced9b7f84b588538d2d65465dcf17015f0977247955801ad6ddaff407107a0575477540eceb2fc3909104ae56e6b217907e0be9eb04db11e37762e5c9b2355e0ba7e4034a4e8cc442db2cb1a1c075713e3b499d52da1fdf1c80b5f63cdd28fb6f2db1bc7f85a6d176424e40c33fa267112482022cd6877252409ca98857163b5b2ca6a911e21c8e9de554ef466196610b7b050a790f69994e8d250000d9ff70f2fc683ea15ee1377a9e33e789974a5bc0457a105c252157575bebf7f67e0e2f920d23908b177550bb694b5f86bb8eed54960d09acc0c89f2371c7bf2c0c06aae820478e7be1b193ea459487930b931541d10bdb0413869eedc18296ee7420abbc0761dfa2418a00cc651aa9a770b66837824493afea5359887173458cb7c30321badb4f411d1e23277faaed73ebbfad93b0f9f1d4af4506d402beaa4f02498353199f28d7eece77fd5a7006e470a0c195cc4f8bd09a618adc9dc599f8d03e05af64fd5f1870f703a1425ca0fc8e8eecb4b53c482300b367b17d9875eb4438e51a7b65f98b62c2d88efe12ca5861429f4a64772b62d3aefd6eb80dee13f9ff407faf3b57e29569d4964f3b7eb3cb523128a11fa3f4fe8af563c7233942ca06593d9b516afaab842d07893321026bd94807bab683b5e03baca7104006fce348a9d2289e17095239874e301ea3a83e3a25322878e280f75fcfad2fd489d6ace1647d5f6a39378020352e2e3d33cf92aea6fb571eee7cd5ffd48bb6302e2594d37168e7aa9457da759bc752396fbed71652ab7568c5e5f539ba2e29b9e525f39618d0d3be143bb143ed99bf3faffae471337c2884ff6ba72ed21030f5d011eba1aeae8369a6bd42b7458bba6896491fdddba9506a890fd556309f1c79a22f00f4edca7e9913f39e7cd4f9cdb6c111a4ff04afe7578084c83439374ca93a2637a786fb5de373808b8306390661e8c609c838eb4ff00ff0463721670648eb7f2e4b8b4a5936506b3a001fa4e2cdb6437684bd5c97b5a365ad226e7d5e61a8285db3b988d76cf43623e4c2cd98d27abf398b2e50073e12407e3b0069de34455281dec34ee9bfba79f6cefa607f3863afef90796b97d6e94db73074b4505d049a7731b84c8dcf5f27bcef9e48988e8e56bb0a0ec55cce4d2c4a934ac29f5181510025975e18d9b7791d77ce599dca80c560aecdd36cb6007267e0c7a8bb9513fa7a6be1cd42e51f81b3f251e80c4db83290fdce7b946860e0f1f92371924710f3fb94de620b1470af3ce87e5badb09a7fa3cd6c637583d90740af998245b171c41eff462e98f307c3a2606e0b68c4dbeafc8617fff4747bcb572ae83b7bec89aad32c56b29f6ca404b653a4ff058674ccd1d812b09e6c50d261c0ae72978adb59fb3d45a37a96a01b96a6d79c9b4e6d036902319305e74b14069d03696b76a41eb06e735e2ac9c5a2bb764c1d3e8be0721f97e3ca46688ab7405b1fadcaaad3bc86fcd174f7810a72daf9ca4d5303900af90c1b8348f62376de09a0ae335dfbabe399103a00b865a52e93592af97030d3d9f09c9f91d3a72e11c2c120a097781f5fb0d33c8667c5a92eceddda4e45e93e0199c4946863d55121986c67d541f34dd4238e0a3daed1ef3550a00f786ffc3435cf57427d4b968ec39e420d2c05aecb2d1c65a0e35136ae8328b3959bbdf9d19a393f4659f7dfd10c383a2147bdaba478a617a5a67a50791e88ea679b4ada141cd2a18a0f9589b47b3384a1332a1e2c80988aa482525d74baa0560a8f64be3f5469dcfee8c3e2edf6b3499300b6d8da7fa66db734e8fba0634d78e29e23425ac1c85f306236117965b9b5722abe0b1796e74d600170d5f0bc748cf54c8ecb1d4931532aea9cd0401e6de4d17dd1551943bcaff5a5c5255eb9d2e98514583716e9ea9fb164fc7d3022012827ef84becc6afdbe1b350ed6ec6f9100d76098efb34f16d9dbaea2f629c224b4fc9b62ddd49653a119e7854d68698bb30d479603d60c70d6ef636f6b37946c95b8b73dd7725884d3f4fcf6272065ecdfa245b3b4b35af068e4edd443330536bab976460fd7349eff9fd44efcfa57e368fc9896dde3a51ccbf9550ca2566e0014729872a29e53bf8ae68371a06b7ff26744dd1fa3974e176f42943e6d26f7c70763d9ee9851af79155ba53d782569e87b5392f08929c109c725acc7476ea79d9f9dfd0657181d5f92ae53556648dd00a9683dba9a48cde6f5d148864333ba8fc6f041eade20a68332fe5efd972845ff0c02c672924908e2e62c468504d5ada216afd3d66ddd601a972c962c75d19a4444af9581b26362369048a5e81baf83c540013562e1892b40da4a296ae7f2a42551d6cba4a8fa88d3ac5574e337533fbde84a8969d98d128daacb681e5da98186cadfd4adefa04d8a2dbbd57bd4c6646f49612eb1f2a7889b21999f94ec56211f14dca19cd12fc3ebcca272bda1eee52a57cfb1bc9f04e4ac55703a233f75c0805105ee0b6a8475048580345ab7cc98a544ee41e8bc214d0d5874e4846943b258609f178a81590f01f14b9673a9ca745064d261b2adf173df404623ba58f5820d1c3e85d52d499a67e0c55e45993519d7bf0bea9b13ab52b9bc2b6ce02603e7e20ae7f073b01b33a2360e5d152803419ccbadadfe221c3b0a84754ad7a4f9300559f2c0d5f55020424d0603f1defd89e0f098a800594b356747dc4beddb7b3b455dd07c13dba063384295a2cb59071928dcb04c9f291048eb59a6222a921af8debdbdd83b7e0c91614b52fabb62b82d4d84775b24122636809e6207d9b00103bacc1a843e899ca9521ba2b32e247f6b9a27aa4504ab2ba1b11174ecb1be8fe119419565d7add3af11394fcd3d0e399dc5be7fd22cdb5f254519c939b7dae5caf41746840f41a57ec18081afbee09d52a3d22792e5653c13d03015c5245a363761a6e6bc119822dad3a8e94ad91b544beb99c1114fd56b9840d27c0e9d9903b2bfbc05a4909cea3e694795fcb7ce310f5d196ed6983dae4584fea0138ab94909222f0f5e30042dcda79a46a1971b1836897c488d4e381143b71b2d7a6a4215b38a243655f65ab3e39337f6e102594b668e147c88f6dc9c5851d3f27d63dc949d51c03a164e21edf4600182146c27c77e9203008daab3508d9f05535f5dba476542ca37701571040c169ec22cf81da72107466e122d2fa9cc0e31f3ac129749cda83cb5d81863efdda2df97902483d8a3c99776a84229c44ef40a3c75503671c142fda9e15e76177c6512f1130d952b472aea7eec3863f45a0984f7e61c316587bf67f6c4e4d0d6d619094d8a9f9cbb7d7a2cbb9ee17ade2ab13bf8891b635b5a14c1fe8ad7a4ff95077f42fee11e563bebe78676464fdc1808317609bc02c99d9fd970b53518888a5c3dc1e7a03ce233c32f711e9c69a3a94c88c5184696f0b0ca1d50a2c885cfd678a8db4b4f3544ade59c38ec6516eeb5842baa934a9be591f3c4b685cfc2164e919a15758b56767f72f26cabad52d6e7dc49fd78ff678b040f15a4de02fba9192920a303b238149828c328e826aa61f53423afc2fbdcae247a637da69b55a0487fe6171e508d2f514f9b61ebfdea9800e56937cac9a50f0199fb7527b7e82ad7faca5facd7feca504d8e53ec52ec3819469ee1f60a27aa09ad347364976046e7808348556981d0948d869b01497bba9826370978d394ac04eb34af3caacd92e7bc609b425fe8632e0cb5c948d3deeb80bb52a1af2d6b4866ebb77a14bc16e421cb6386ec1cd08d758eea85ab1bade56c7ffbc0e02f1ea1b4af59a8b97832e2ef20e137b705a997b01cf70c0488593b78a2b03111d398079876e4d78eb09f0ab6d316234baeee5d16cc5ff27058a355b1d1d446fec2e88a2cd93e2484d9a0acdb448d821f5e5fdac76483f245875dcf39ab7b94313c5cf5a0365b7bdc5767d54fd396a49ec4d75414a49c14bfcec5fc675cdb0cbda22d967b4c04684507641139f57908d20634524b1d2b9e69ba1da033be708b489d2aede6f62d7f0c9cd6002314c694726a5aecf9e9cf98d2a8340c9b183f1ae341147fed7e39fdcdcc5d54c7eb973ca3984b54dbcc61e332df8abfc20ec323393e4731a5598e85ab16faa269a0ef035c3bb424914cd75c91a9c60e8e976f424eae9e84a1fbc2c88bdf8ca7bd252dc9767612ea6711d497bc3dbbccdaaa7e3f934e676ef3464af76197508843951af14c212d2a8ba47d7af64fc6fe415958db233475471440299ecba57ab9c434dbf4eee99995607c08c00eff4de386a532213ad477eaee9367881f7d93904b6000ef82c863f83057f5cd1af1d7004cdbe2a4b27d3ffdaa9fd6ef9b3c9c5173fb9231d50ac7030ea0be204b7cba41a1511123733c835e75ce3748bec5b70f616c32df8d29007ad0d878880ef75c46658ad9cb44ae0075ee0269004ed58aec72a189a1f51d597e2433ed7f29449d332894eab57950e382d80612de14d5aa2fce22a2c8324167d1990636c15fa2dfe301172a973cf7e7cf94418822abef7223223d4496ba91ba7d3b50cc072ad1c3fe729f1aa61a41afc224c9609fa745c5f9d086db5b6bc7a3bfdf6e67e2b0ebb9993fc1ee7b0a08757845d05a9d95e9689b7ed53b5870cb6a2596d5e35cf9f590401c1ede237969b77adb833dd7f1881f652495b1383faf7b80aec52dd6175bb65f0dae8488d143d6e99ca05c995687c703723d26065582daf7efbea7a43db054b61ca4da99c93f02f115d76e40cfafd7ed7cfbb37cef31ee7ac700aafe64f08c6a90c6de9fe8addfbbcf21640c1e35dfde735dae70885c06b1bc0cbe44caf6dc0b5f9b66bbee55c1c924ed2123a73fda69f03318942e045064683c2a4f3ac16cd609abfc518a0429d4c00e38cd31b4aaab3bdaf2c0a7cf0aeefc5010f4daa3850fa6b7947289b389932235eb9a9ca0ff39d1b00df75f342aacdee3b45fc872ae7b1ecaf782edf7c49e25f6f2b230be9ceff0e4f38b0648c2d0afe058741f1f73817abf0f8cb3d571a6d256f5aa75d4926f86ea529cc16a1f7c748dbb21eab17123f37e1d3edbc306716694f06e82aee0163e4d089ca44154b75e0a466da488e9d9618837cfa30e8745bda1484d600fb82f94ac83f1439f956bd2c217a1b55a6bc84f3a89728e27f241946241b235f39872f431be2d86b358cf5aa39c27c3387a74327c1458a4197c79fdb778dbb8e003ba1fe0cb8d7f5a4b59581bcef69a6a219324575a5ce150ad7d6c7798eae7681b1453f947cca0743605d79bbe0f0164182473c889d53c62962be351f5a09cea50cb8f2e96b33c854027c180a91c817fd9adab42eb354ece697289e9ac9dcc8317e39a5fb73104e8484aba3cf77bf88053a257e8b5fa34b6eff2cd8d208ef20d5c7d56319ffb817cfd5ed1bd104509e81a0a590e917bd9eca2a360a3f612ada44596624726501b8e8925fe228db6ec7b287b75b3486e704d7cfd44e4c4b78301fcaff73519827c669f1f4bf21c04d9674ba4bebbfe9b13acdd01acd975e31c6ab19e202f7d733fa6d18df68cde08863ea051e47c0a58eb695ad394e26a39b0aa69439ef9c7d10b0544155123441657e9dbecbf4133547555b6a72364a516e9fa4aab94168979cca294550559fb3b5e6086c739fb3e7effe0f151d3e547c83ba31354147a1d7de0000000000000000000000000000000910181d252d353c",
  },
]

describe("ML-DSA-87", () => {
  for (let i = 0; i < TEST_VECTORS.length; i++) {
      it(`Should process the test ${i} correctly`, async function() {
        const vector = TEST_VECTORS[i];

        const {publicKey, secretKey} = ml_dsa87.keygen(hexToBytes(vector.seed));
        deepStrictEqual(bytesToHex(secretKey), vector.derivedSK);
        deepStrictEqual(bytesToHex(publicKey), vector.derivedPK);

        const msg = utf8ToBytes(vector.msg)
        const ctx = utf8ToBytes(vector.ctx)
        // NOTE(rgeraldes24): The 3rd arg is the context instead of random; same  
        // issue as https://github.com/paulmillr/noble-post-quantum/issues/30
        const sig = ml_dsa87.sign(secretKey, msg, ctx);
        deepStrictEqual(bytesToHex(sig), vector.derivedSig);

        // NOTE(rgeraldes24): The 4th arg is the context; same issue as 
        // https://github.com/paulmillr/noble-post-quantum/issues/30
        // @ts-ignore
        deepStrictEqual(ml_dsa87.verify(publicKey, msg, sig, ctx), true);
      });
  }
});